import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.4719a631.js";const f=JSON.parse('{"title":"Examples","description":"","frontmatter":{},"headers":[],"relativePath":"docs/strategies/example-strategies.md","filePath":"docs/strategies/example-strategies.md"}'),p={name:"docs/strategies/example-strategies.md"},o=l(`<h1 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;Examples&quot;">​</a></h1><p>To get you started we prepared a few examples of how to approach certain scenarios often used in trading.</p><p>For working strategies check out these repositories:</p><ul><li><a href="https://github.com/jesse-ai/example-strategies" target="_blank" rel="noreferrer">https://github.com/jesse-ai/example-strategies</a></li><li><a href="https://github.com/nicolay-zlobin/jesse-indicators" target="_blank" rel="noreferrer">https://github.com/nicolay-zlobin/jesse-indicators</a></li></ul><h2 id="crossovers" tabindex="-1">Crossovers <a class="header-anchor" href="#crossovers" aria-label="Permalink to &quot;Crossovers&quot;">​</a></h2><p>Let&#39;s try to catch the moment the price moves above the bollinger middleband.</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">long_cross</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.bb.middleband[</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles[:, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">][</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.bb.middleband[</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bb</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> ta.bollinger_bands(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles, </span><span style="color:#FFAB70;">sequential</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">long_cross</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.bb.middleband[</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles[:, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">][</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.bb.middleband[</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bb</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ta.bollinger_bands(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles, </span><span style="color:#E36209;">sequential</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span></code></pre></div><p>As alternative you could use the <a href="https://docs.jesse.trade/docs/utils.html#crossed" target="_blank" rel="noreferrer">crossed</a> utility:</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">long_cross</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> utils.crossed(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles[:, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">], </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.bb.middleband, </span><span style="color:#9ECBFF;">&#39;above&#39;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bb</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> ta.bollinger_bands(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles, </span><span style="color:#FFAB70;">sequential</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">long_cross</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> utils.crossed(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles[:, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">], </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.bb.middleband, </span><span style="color:#032F62;">&#39;above&#39;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bb</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ta.bollinger_bands(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles, </span><span style="color:#E36209;">sequential</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="stoploss-take-profit" tabindex="-1">Stoploss / Take Profit <a class="header-anchor" href="#stoploss-take-profit" aria-label="Permalink to &quot;Stoploss  / Take Profit&quot;">​</a></h2><p>Simple ATR:</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">go_long</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    take_profit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.atr </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    stop </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.atr </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.buy </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.stop_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, stop  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.take_profit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, take_profit  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">atr</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> ta.atr(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles, </span><span style="color:#FFAB70;">period</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">22</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">go_long</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    take_profit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.atr </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    stop </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.atr </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.buy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.stop_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, stop  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.take_profit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, take_profit  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">atr</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ta.atr(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles, </span><span style="color:#E36209;">period</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">22</span><span style="color:#24292E;">)</span></span></code></pre></div><p>A trailing stop:</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">update_position</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># update trailing_stop_loss only if in profit  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.position.pnl </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.is_long:  </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.stop_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.position.qty, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.atr </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.stop_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.position.qty, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.atr </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">update_position</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># update trailing_stop_loss only if in profit  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.position.pnl </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.is_long:  </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.stop_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.position.qty, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.atr </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.stop_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.position.qty, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.atr </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span></code></pre></div><p>You also can use Moving Averages to exit once they are hit.</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">update_position</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.is_long </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.exit_ema:  </span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.liquidate()  </span></span>
<span class="line"><span style="color:#E1E4E8;">       </span></span>
<span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">exit_ema</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> ta.ema(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.candles)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">update_position</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.is_long </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.exit_ema:  </span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.liquidate()  </span></span>
<span class="line"><span style="color:#24292E;">       </span></span>
<span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">exit_ema</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ta.ema(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.candles)</span></span></code></pre></div><p>Special indicators you might want to try for your exits:</p><ul><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#safezonestop" target="_blank" rel="noreferrer">safezonestop</a></li><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#devstop" target="_blank" rel="noreferrer">devstop</a></li><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#kaufmanstop" target="_blank" rel="noreferrer">kaufmanstop</a></li></ul><p>Channels can also be good for stoploss or take profit:</p><ul><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#keltner" target="_blank" rel="noreferrer">Keltner</a></li><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#donchian" target="_blank" rel="noreferrer">Donchian</a></li><li><a href="https://docs.jesse.trade/docs/indicators/reference.html#bollinger-bands" target="_blank" rel="noreferrer">Bollinger Bands</a></li></ul><h2 id="getting-the-size-right" tabindex="-1">Getting the size right <a class="header-anchor" href="#getting-the-size-right" aria-label="Permalink to &quot;Getting the size right&quot;">​</a></h2><p>This example might help with the position size/qty. We use risk management. There might be situations where risk_to_qty returns a qty exceeding the available capital leading to an exception. The reason for this is a very close stop loss (often due to the usage of the ATR). That&#39;s not an error, but the expected behavior of the formula. We add a logic limiting the qty to a maximum percentage (in this case 25 %) of the capital for those cases.</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">go_long</span><span style="color:#E1E4E8;">(self):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    stop </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.bb.lowerband</span></span>
<span class="line"><span style="color:#E1E4E8;">    qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.position_size(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price, stop)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    take_profit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.bb.upperband</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.buy </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.price  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.stop_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, stop  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.take_profit </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> qty, take_profit  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">@</span><span style="color:#79B8FF;">property</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">position_size</span><span style="color:#E1E4E8;">(self, entry, stop):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># risk 10%</span></span>
<span class="line"><span style="color:#E1E4E8;">    risk_qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utils.risk_to_qty(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.balance, </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, entry, stop, </span><span style="color:#FFAB70;">fee_rate</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.fee_rate)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># never risk more than 25% of the capital</span></span>
<span class="line"><span style="color:#E1E4E8;">    max_qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utils.size_to_qty(</span><span style="color:#79B8FF;">0.25</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.balance, entry, </span><span style="color:#FFAB70;">precision</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fee_rate</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.fee_rate)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">min</span><span style="color:#E1E4E8;">(risk_qty, max_qty) </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> qty</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">go_long</span><span style="color:#24292E;">(self):  </span></span>
<span class="line"><span style="color:#24292E;">    stop </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.bb.lowerband</span></span>
<span class="line"><span style="color:#24292E;">    qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.position_size(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price, stop)  </span></span>
<span class="line"><span style="color:#24292E;">    take_profit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.bb.upperband</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.buy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.price  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.stop_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, stop  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.take_profit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> qty, take_profit  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">@</span><span style="color:#005CC5;">property</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">position_size</span><span style="color:#24292E;">(self, entry, stop):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># risk 10%</span></span>
<span class="line"><span style="color:#24292E;">    risk_qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utils.risk_to_qty(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.balance, </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">, entry, stop, </span><span style="color:#E36209;">fee_rate</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.fee_rate)  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># never risk more than 25% of the capital</span></span>
<span class="line"><span style="color:#24292E;">    max_qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utils.size_to_qty(</span><span style="color:#005CC5;">0.25</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.balance, entry, </span><span style="color:#E36209;">precision</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fee_rate</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.fee_rate)  </span></span>
<span class="line"><span style="color:#24292E;">    qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">min</span><span style="color:#24292E;">(risk_qty, max_qty) </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> qty</span></span></code></pre></div><p>Using the kelly criterion:</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kelly_qty</span><span style="color:#E1E4E8;">(self, entry, stop):  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.metrics </span><span style="color:#F97583;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.metrics[</span><span style="color:#9ECBFF;">&#39;total&#39;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">        win_rate </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.46</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">        ratio_avg_win_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.6</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">        win_rate </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.metrics[</span><span style="color:#9ECBFF;">&#39;win_rate&#39;</span><span style="color:#E1E4E8;">]  </span></span>
<span class="line"><span style="color:#E1E4E8;">        ratio_avg_win_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.metrics[</span><span style="color:#9ECBFF;">&#39;ratio_avg_win_loss&#39;</span><span style="color:#E1E4E8;">]  </span></span>
<span class="line"><span style="color:#E1E4E8;">    kc </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utils.kelly_criterion(win_rate, ratio_avg_win_loss) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> kc </span><span style="color:#F97583;">or</span><span style="color:#E1E4E8;"> kc </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">raise</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ValueError</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Bad Kelly criterion.&quot;</span><span style="color:#E1E4E8;">)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    risk_qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utils.risk_to_qty(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.available_margin, kc, entry, stop, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.fee_rate)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># never risk more than 25%  </span></span>
<span class="line"><span style="color:#E1E4E8;">    max_qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> utils.size_to_qty(</span><span style="color:#79B8FF;">0.25</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.available_margin, entry, </span><span style="color:#FFAB70;">precision</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fee_rate</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.fee_rate)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    qty </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">min</span><span style="color:#E1E4E8;">(risk_qty, max_qty)  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> qty</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kelly_qty</span><span style="color:#24292E;">(self, entry, stop):  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.metrics </span><span style="color:#D73A49;">or</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.metrics[</span><span style="color:#032F62;">&#39;total&#39;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">        win_rate </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.46</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">        ratio_avg_win_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.6</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">        win_rate </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.metrics[</span><span style="color:#032F62;">&#39;win_rate&#39;</span><span style="color:#24292E;">]  </span></span>
<span class="line"><span style="color:#24292E;">        ratio_avg_win_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.metrics[</span><span style="color:#032F62;">&#39;ratio_avg_win_loss&#39;</span><span style="color:#24292E;">]  </span></span>
<span class="line"><span style="color:#24292E;">    kc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utils.kelly_criterion(win_rate, ratio_avg_win_loss) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> kc </span><span style="color:#D73A49;">or</span><span style="color:#24292E;"> kc </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">raise</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ValueError</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Bad Kelly criterion.&quot;</span><span style="color:#24292E;">)  </span></span>
<span class="line"><span style="color:#24292E;">    risk_qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utils.risk_to_qty(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.available_margin, kc, entry, stop, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.fee_rate)  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># never risk more than 25%  </span></span>
<span class="line"><span style="color:#24292E;">    max_qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> utils.size_to_qty(</span><span style="color:#005CC5;">0.25</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.available_margin, entry, </span><span style="color:#E36209;">precision</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fee_rate</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.fee_rate)  </span></span>
<span class="line"><span style="color:#24292E;">    qty </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">min</span><span style="color:#24292E;">(risk_qty, max_qty)  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> qty</span></span></code></pre></div><p>We need to check for a minimum of trades so we have a good <code>win_rate</code> and <code>ratio_avg_win_loss</code> to work with. In this case, we use 20 trades. For those first trades we use hardcoded values, we got from backtests. <code>win_rate</code> is the same as <strong>Percent Profitable / 100</strong>. <code>ratio_avg_win_loss</code> is called <strong>Ratio Avg Win / Avg Loss</strong>.</p>`,26),e=[o];function t(r,c,y,E,i,F){return a(),n("div",null,e)}const C=s(p,[["render",t]]);export{f as __pageData,C as default};
